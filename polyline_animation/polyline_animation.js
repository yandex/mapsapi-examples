ymaps.ready(init);

function init(ymaps) {
    // Создаем карту.
    var myMap = new ymaps.Map("map", {
                center: [55.761292231982466, 37.57835813659775],
                zoom: 16
            }, {
                searchControlProvider: 'yandex#search'
            });
    var firstCoords = [[55.7602953585417, 37.57705113964169], [55.7603453585417, 37.577050452235255], [55.7603953585417, 37.57704976482882], [55.7604453585417, 37.57704907742239], [55.760495358541704, 37.57704839001595], [55.760545358541705, 37.57704770260952], [55.76059535854171, 37.577047015203085], [55.76064535854171, 37.57704632779665], [55.76068555113675, 37.57704577522367], [55.76069070831095, 37.576995775223665], [55.760695865485154, 37.57694577522366], [55.760701022659354, 37.57689577522366], [55.760706179833555, 37.57684577522366], [55.76070823663214, 37.57682583408445], [55.76074604576167, 37.57683119850248], [55.760741360401255, 37.576881198502484], [55.76073667504084, 37.576931198502486], [55.76073198968042, 37.57698119850249], [55.76072730432001, 37.57703119850249], [55.76072261895959, 37.57708119850249], [55.760717933599175, 37.57713119850249], [55.76071324823876, 37.577181198502494], [55.76071035515236, 37.57721207218258], [55.760760355152364, 37.577231924661156], [55.760810355152366, 37.57725177713973], [55.76086035515237, 37.5772716296183], [55.76091035515237, 37.577291482096875], [55.76096035515237, 37.57731133457545], [55.760995831117725, 37.577325420292276], [55.76099147049988, 37.57737542029228], [55.76098710988204, 37.57742542029228], [55.760982749264194, 37.57747542029228], [55.76097838864635, 37.57752542029228], [55.76097402802851, 37.577575420292284], [55.76096966741066, 37.577625420292286], [55.76096530679282, 37.57767542029229], [55.760960946174976, 37.57772542029229], [55.76095658555713, 37.57777542029229], [55.76095222493929, 37.57782542029229], [55.760947864321444, 37.577875420292294], [55.7609435037036, 37.577925420292296], [55.76093914308576, 37.5779754202923], [55.76093478246791, 37.5780254202923], [55.76093042185007, 37.5780754202923], [55.760926061232226, 37.5781254202923], [55.76092170061438, 37.578175420292304], [55.76091733999654, 37.578225420292306], [55.760914340103085, 37.5782598178652], [55.760915438508, 37.578309817865204], [55.760916536912916, 37.578359817865206], [55.76091763531783, 37.57840981786521], [55.76091873372275, 37.57845981786521], [55.76091887717649, 37.57846634795934], [55.76092592527235, 37.578516347959344], [55.76093297336821, 37.578566347959345], [55.76094002146407, 37.57861634795935], [55.760940050178704, 37.57861655166418], [55.760954649793625, 37.578666551664185], [55.76096924940855, 37.578716551664186], [55.76098384902347, 37.57876655166419], [55.76098390850371, 37.578766755369024], [55.76100605961685, 37.578816755369026], [55.76102821072998, 37.57886675536903], [55.761033816192594, 37.57887940814763], [55.761083816192595, 37.57891833940024], [55.76109582262579, 37.57892768790992], [55.76111238308866, 37.578877687909916], [55.761128943551526, 37.578827687909914], [55.761145504014394, 37.57877768790991], [55.76116206447726, 37.57872768790991], [55.76117862494013, 37.57867768790991], [55.761195185403, 37.57862768790991], [55.761211745865864, 37.578577687909906], [55.76122285988697, 37.578544132020774], [55.76124150875864, 37.57849413202077], [55.7612601576303, 37.57844413202077], [55.76127880650197, 37.57839413202077]];
    var secondCoords = [[55.761292231982466, 37.57835813659775], [55.761317941807874, 37.57840105194199], [55.761367941807876, 37.578445769666835], [55.76141794180788, 37.57849048739168], [55.76146794180788, 37.57853520511653], [55.76149488543863, 37.57855930227387], [55.76154488543863, 37.5785789060312], [55.76159488543863, 37.57859850978853], [55.761644885438635, 37.57861811354586], [55.76169488543864, 37.57863771730319], [55.76172838090496, 37.57865085004307], [55.76174821957409, 37.57860085004307], [55.761757115091825, 37.57857843039969], [55.761787361581355, 37.57855965493657], [55.76183736158136, 37.578561638171486], [55.76188736158136, 37.5785636214064], [55.76193736158136, 37.57856560464132], [55.76198736158136, 37.578567587876236], [55.76203736158136, 37.57856957111115], [55.762087361581365, 37.57857155434607], [55.76213736158137, 37.578573537580986], [55.76218736158137, 37.5785755208159], [55.76223736158137, 37.57857750405082], [55.76226071607272, 37.57857843039969], [55.76231071607272, 37.57853794332022], [55.76236071607272, 37.578497456240754], [55.76241071607272, 37.57845696916129], [55.762460716072724, 37.57841648208182], [55.76246734223822, 37.57841111660003], [55.76249496962702, 37.57836111660003], [55.762522597015824, 37.57831111660003], [55.76255022440463, 37.578261116600025], [55.76257785179343, 37.57821111660002], [55.762605479182234, 37.57816111660002], [55.76261554710084, 37.578142895698534], [55.76263624055575, 37.57809289569853], [55.76265693401066, 37.57804289569853], [55.762677627465564, 37.57799289569853], [55.76269832092047, 37.57794289569853], [55.76271901437538, 37.577892895698525], [55.762739707830285, 37.577842895698524], [55.76276040128519, 37.57779289569852], [55.7627810947401, 37.57774289569852], [55.762801788195006, 37.57769289569852], [55.76282248164991, 37.57764289569852], [55.762824242784966, 37.57763864040372], [55.76285817636244, 37.57758864040372], [55.76289210993992, 37.577538640403716], [55.76292254108817, 37.57749380111693], [55.7629174375545, 37.57744380111693], [55.762912334020825, 37.577393801116926], [55.76290723048715, 37.577343801116925], [55.76290212695348, 37.57729380111692], [55.762897023419804, 37.57724380111692], [55.76289191988613, 37.57719380111692], [55.76289078320203, 37.577182664871195], [55.76289586265221, 37.57713266487119], [55.762900942102384, 37.57708266487119], [55.76290602155256, 37.57703266487119], [55.762911101002736, 37.57698266487119], [55.76291618045291, 37.57693266487119], [55.76292102880847, 37.576884939670556], [55.76295355678472, 37.576834939670555], [55.762986084760975, 37.57678493967055], [55.76298908133677, 37.57678033351896], [55.76303908133677, 37.57673446391364], [55.76307679330843, 37.576699867248514], [55.76307941531943, 37.576749867248516], [55.763082037330435, 37.57679986724852], [55.76308465934144, 37.57684986724852], [55.76308728135244, 37.57689986724852], [55.76308990336344, 37.57694986724852], [55.76309252537445, 37.576999867248524], [55.76309514738545, 37.577049867248526], [55.76309776939645, 37.57709986724853], [55.763100391407455, 37.57714986724853], [55.76310301341846, 37.57719986724853], [55.763105418792314, 37.57724573612205]];
    // Создаем линии.
    var firstLine = new ymaps.Polyline([], {}, {
        // Задаем цвет.
        strokeColor: "#ED4543",
        // Задаем ширину линии.
        strokeWidth: 5
    });
    var secondLine = new ymaps.Polyline([], {}, {
        strokeColor: "#1E98FF",
        strokeWidth: 5
    });
    // Добавляем линии на карту.
    myMap.geoObjects.add(firstLine);
    myMap.geoObjects.add(secondLine);
    // Создаем метки.
    var firstPoint = new ymaps.Placemark([55.7602953585417, 37.57705113964169], {}, {
        preset: 'islands#redRapidTransitCircleIcon'
    });
    var secondPoint = new ymaps.Placemark([55.76127880650197, 37.57839413202077], {}, {
        preset: 'islands#blueMoneyCircleIcon'
    });
    var thirdPoint = new ymaps.Placemark([55.763105418792314, 37.57724573612205], {}, {
        preset: 'islands#blackZooIcon'
    });
    // Добавляем первую метку на карту.
    addFirstPoint();
    function addFirstPoint() {
        myMap.geoObjects.add(firstPoint);
        // Отрисовываем первую линию на карте.
        drawLine(firstLine, firstCoords, addSecondPoint);
    }
    // Добавляем вторую метку на карту.
    function addSecondPoint() {
        myMap.geoObjects.add(secondPoint);
        // Отрисовываем вторую линию на карте.
        drawLine(secondLine, secondCoords, addThirdPoint);
    }
    // Плавно отрисовываем линию по переданным координатам.
    function drawLine(line, coords, callback) {
        var value = 0;
        function loop(value) {
            if (value < coords.length) {
                line.geometry.set(value, coords[value]);
                value++;
                setTimeout(function(){loop(value)}, 50);
            } else {
                callback();
            }
        }
        loop(0);
    }
    // Добавляем третью метку на карту.
    function addThirdPoint() {
        myMap.geoObjects.add(thirdPoint);
        // Удаляем все метки и линии с карты и перезапускаем цикл рисования.
        setTimeout(function() {
            firstLine.geometry.setCoordinates([]);
            secondLine.geometry.setCoordinates([]);
            myMap.geoObjects.remove(firstPoint);
            myMap.geoObjects.remove(secondPoint);
            myMap.geoObjects.remove(thirdPoint);

            addFirstPoint();
        }, 2000)
    }
}

