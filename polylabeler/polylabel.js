ymaps.modules.define("polylabel.config",[],function(e){e({MIN_ZOOM:0,MAX_ZOOM:23,DEFAULT_POLYGON_FILL_COLOR:"0066ff99",options:["labelLayout","labelDotLayout","labelDotVisible","labelDefaults","labelCursor","labelDotCursor"],zoomRangeOptions:["labelClassName","labelForceVisible","labelTextColor","labelTextSize","labelCenterCoords","labelOffset","labelPermissibleInaccuracyOfVisibility"],properties:[]})}),ymaps.modules.define("polylabel.create",["polylabel.polylabel.PolylabelCollection","polylabel.polylabel.PolylabelObjectManager","ObjectManager"],function(e,t,o,a){function n(){var e=document.createElement("style");e.innerText="\n        .ymaps-polylabel-dot-default {\n            border: 1px solid rgba(255, 255, 255, 0.8);\n            height: 4px;\n            width: 4px;\n            border-radius: 3px;\n        }\n        .ymaps-polylabel-dot-default_hover {\n            border: 1px solid rgba(255, 255, 255, 1);\n        }\n        .ymaps-polylabel-label-default {\n            font-family: Arial, Helvetica, sans-serif;\n            text-align: center;\n        }\n        .ymaps-polylabel-dark-label {\n            color: #06264f;\n            -webkit-font-smoothing: subpixel-antialiased;\n            text-shadow:\n            0 -1px 0 rgba( 255, 255, 255, 0.4 ),\n            0 -1px 0 rgba( 255, 255, 255, 0.4 ),\n            0 1px 0 rgba( 255, 255, 255, 0.4 ),\n            0 1px 0 rgba( 255, 255, 255, 0.4 ),\n            -1px 0 0 rgba( 255, 255, 255, 0.4 ),\n            1px 0 0 rgba( 255, 255, 255, 0.4 ),\n            -1px 0 0 rgba( 255, 255, 255, 0.4 ),\n            1px 0 0 rgba( 255, 255, 255, 0.4 ),\n            -1px -1px 0 rgba( 255, 255, 255, 0.4 ),\n            1px -1px 0 rgba( 255, 255, 255, 0.4 ),\n            -1px 1px 0 rgba( 255, 255, 255, 0.4 ),\n            1px 1px 0 rgba( 255, 255, 255, 0.4 ),\n            -1px -1px 0 rgba( 255, 255, 255, 0.4 ),\n            1px -1px 0 rgba( 255, 255, 255, 0.4 ),\n            -1px 1px 0 rgba( 255, 255, 255, 0.4 ),\n            1px 1px 0 rgba( 255, 255, 255, 0.4 );\n            opacity: 0.9;\n        }\n        .ymaps-polylabel-light-label {\n            color: rgba(255, 255, 255, 1);\n            text-shadow: 0 0 2px rgba(0, 0, 0, 1), 0 0 2px rgba(0, 0, 0, 1);\n        }\n    ",document.head.appendChild(e)}e(function(e,l){return n(),l instanceof a?new o(e,l):new t(e,l)})}),ymaps.modules.define("polylabel.label.GeoObjectCollection.Label",["util.defineClass","vow","util.extend","util.objectKeys","Placemark","polylabel.label.util.LabelPlacemarkOverlay","polylabel.label.util.layoutTemplates.getBaseLayoutTemplates","polylabel.label.LabelBase"],function(e,t,o,a,n,l,i,s,r){function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}e(function(e){function r(t,o,a,n){p(this,r);var l=c(this,e.call(this));return l._map=t,l._polylabel=n,l._polygon=o,l._parentCollection=a,l._placemark={label:null,dot:null},l._layout={label:null,dot:null},l._init(),l}return t(r,e),r.prototype.removeFromCollection=function(){var e=this;this._parentCollection&&(["label","dot"].forEach(function(t){-1!==e._parentCollection.indexOf(e._placemark[t])&&e._parentCollection.remove(e._placemark[t])}),this._polygon=null,this._parentCollection=null,this._placemark=null,this._layout=null,this._data=null)},r.prototype.addToCollection=function(){var e=this;if(!this._parentCollection)return o.Promise.reject();var t=["label","dot"].map(function(t){return e._placemark[t].getParent()||e._parentCollection.add(e._placemark[t]),e.getLabelLayout(t).then(function(o){e.setLayout(t,o)})});return o.Promise.all(t)},r.prototype.getLabelLayout=function(e){return this._placemark[e].getOverlay().then(function(e){return e.getLayout()})},r.prototype._init=function(){this._baseLayoutTemplates=s()},r.prototype.createPlacemarks=function(){var e=this;["label","dot"].forEach(function(t){e._placemark[t]=r._createPlacemark({properties:a({},{polygon:e._polygon},e._polygon.properties.getAll()),options:e.getFormedOptionsForPlacemark(t)},e._baseLayoutTemplates[t],e._data.getCenterCoords(e._map.getZoom()))})},r._createPlacemark=function(e,t,o){var n=a({},{iconLayout:t,pointOverlay:i,iconLabelPosition:"absolute"},e.options);return new l(o,e.properties,n)},r.prototype.setDataByZoom=function(e,t){var o=this;["dot","label"].forEach(function(t){if("label"===t){var a=o._data.getStyles(e);o.setStyles({className:a.className,textSize:a.textSize,textColor:a.textColor})}o.setVisibilityForce("none"),o._data.setVisible(e,t,o._layout[t])});var a=this.setVisibility(t,this._data.getVisibility(e),this._data.getData("dotVisible")),n=this._data.getCenterCoords(e);return-1!==["label","dot"].indexOf(a)&&this._data.getSize(e,a)&&(this.setCoordinates(n),this.setOffsetAndIconShape(a,this._data.getSize(e,a),this._data.getOffset(e))),{currentVisibleType:a,currentConfiguredVisibileType:this._data.getVisibility(e),currentCenter:n}},r.prototype.setLayoutTemplate=function(){var e=this;this.createLayoutTemplates(),n(this._layoutTemplates).forEach(function(t){e._placemark[t].options.set(e._layoutTemplates[t])})},r.prototype.setNewOptions=function(e){var t=this;["dot","label"].forEach(function(o){t._placemark[o].options.set(e)})},r.prototype.setCoordinates=function(e){var t=this;e.toString()!==this._placemark.label.geometry.getCoordinates().toString()&&["dot","label"].forEach(function(o){t._placemark[o].geometry.setCoordinates(e)})},r.prototype.setVisibilityForce=function(e){var t=this;n(this._placemark).forEach(function(o){var a=t.analysePane(o,e);t._placemark[o].options.get("pane")!==a&&t._placemark[o].options.set({pane:a})})},r.prototype.setStyles=function(e){var t=this.analyseStyles(e);t.isChange&&this._placemark.label.options.set(t.styles)},r.prototype.setOffsetAndIconShape=function(e,t,o){var a=this.analyseOffset(t,o);this._placemark[e].options.set({iconShape:this.analyseShape(e,t,o),iconLabelLeft:a.left,iconLabelTop:a.top})},r.prototype.destroy=function(){this.removeFromCollection()},r}(r))}),ymaps.modules.define("polylabel.label.LabelBase",["vow","util.extend","util.objectKeys","polylabel.label.util.layoutTemplates.createLayoutTemplates","polylabel.label.util.LabelData","polylabel.label.util.classHelper","polylabel.label.util.getLayoutSize"],function(e,t,o,a,n,l,i,s){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e(function(){function e(){r(this,e),this._baseLayoutTemplates=null,this._layoutTemplates=null}return e.prototype.getPolylabelType=function(){return this._polylabel.getPolylabelType()},e.prototype.getPlacemark=function(e){return this._placemark[e]},e.prototype.getLayout=function(e){return this._layout[e]},e.prototype.setLayout=function(e,t){this._layout[e]=t,this._initLayoutSizeChangeHandler(t)},e.prototype.updateLayouts=function(){var e=this;this.getLabelLayout("label").then(function(t){e.setLayout("label",t)}),this.getLabelLayout("dot").then(function(t){e.setLayout("dot",t)})},e.prototype._initLayoutSizeChangeHandler=function(e){var o=this,a=e.getElement();if(a){var n=Array.prototype.slice.call(a.getElementsByTagName("img"));n.length>0&&t.Promise.all(n.map(function(e){return e.complete?t.Promise.resolve():new t.Promise(function(t){return e.onload=t})})).then(function(){var t=s(e);t&&t.width>0&&t.height>0&&o._polylabel._setLabelData(o._polygon,o,void 0,["dot","label"])})}},e.prototype.getPolygonOptions=function(){return"collection"===this.getPolylabelType()?this._polygon.options.getAll():this._polygon.options},e.prototype.getLabelOptions=function(){var e=this._placemark.label;return"collection"===this.getPolylabelType()?e.options.getAll():e.options},e.prototype.getFormedOptionsForPlacemark=function(e){var t=this._data.getLabelCursors();return o({},this.getPolygonOptions(),this._layoutTemplates[e],t[e])},e.prototype.createLayoutTemplates=function(){var e=this.getPolygonOptions(),t=e.labelLayout,o=e.labelDotLayout;this._prevLayout&&this._prevLayout.dot===o&&this._prevLayout.label===t||(this._layoutTemplates=n(t,o),this._prevLayout={dot:o,label:t})},e.prototype.analyseVisibility=function(e,t,o){var a=e&&"auto"!==e?e:t;return"dot"!==a||o||(a="none"),a},e.prototype.setVisibility=function(e,t,o){var a=this.analyseVisibility(e,t,o);return this.setVisibilityForce(a),a},e.prototype.createLabelData=function(e,t){return this._data=new l(this._polygon,e,t,this._map,this),this._data},e.prototype.getLabelData=function(){return this._data},e.prototype.analysePane=function(e,t){return e===t?"places":"phantom"},e.prototype.analyseOffset=function(e,t){var o=e.height/2;return{left:-(e.width/2)+t[0],top:-o+t[1]}},e.prototype.analyseStyles=function(e){var t=this.getLabelOptions(),o=!1;return a(e).forEach(function(a){t["iconLabel"+a[0].toUpperCase()+a.slice(1)]!==e[a]&&(o=!0)}),{isChange:o,styles:{iconLabelClassName:e.className,iconLabelTextSize:e.textSize,iconLabelTextColor:e.textColor}}},e.prototype.analyseShape=function(e,t,o){var a=t.height/2,n=t.width/2,l="dot"===e&&this._data.isDotDefault?2:0;return{type:"Rectangle",coordinates:[[-n+o[0]-l,-a+o[1]-l],[n+o[0]+l,a+o[1]+l]]}},e.prototype.addDotClass=function(e){i.add(this._layout.dot,"ymaps-polylabel-dot-default",e)},e.prototype.removeDotClass=function(e){i.remove(this._layout.dot,"ymaps-polylabel-dot-default",e)},e}())}),ymaps.modules.define("polylabel.label.ObjectManager.Label",["util.defineClass","vow","util.extend","util.objectKeys","polylabel.label.util.LabelPlacemarkOverlay","polylabel.label.util.layoutTemplates.getBaseLayoutTemplates","polylabel.label.LabelBase"],function(e,t,o,a,n,l,i,s){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}e(function(e){function s(t,o,a,n){r(this,s);var l=p(this,e.call(this));return l._map=t,l._polylabel=n,l._polygon=o,l._objectManager=a,l._placemark={label:null,dot:null},l._layout={label:null,dot:null},l._init(),l}return t(s,e),s.prototype.destroy=function(){this.removeFromObjectManager()},s.prototype.addToObjectManager=function(){var e=this;this.setLayoutTemplate(),["label","dot"].forEach(function(t){e._objectManager.add(e._placemark[t])})},s.prototype.removeFromObjectManager=function(){var e=this;["label","dot"].forEach(function(t){e._objectManager.remove(e._placemark[t])}),this._polygon=null,this._objectManager=null,this._placemark=null,this._layout=null,this._data=null},s.prototype._init=function(){this._baseLayoutTemplates=i()},s.prototype.getLabelLayout=function(e){var t=this._objectManager.objects.overlays.getById(this._placemark[e].id);return t?t.getLayout():o.Promise.reject()},s.prototype.createPlacemarks=function(){var e=this;["label","dot"].forEach(function(t){e._placemark[t]=s._createPlacemark(t+"#"+e._polygon.id,{properties:a({},{polygon:e._polygon},e._polygon.properties),options:e.getFormedOptionsForPlacemark(t)},e._baseLayoutTemplates[t],e._data.getCenterCoords(e._map.getZoom()))})},s._createPlacemark=function(e,t,o,n){return{type:"Feature",id:e,options:a({},{iconLayout:o,iconLabelPosition:"absolute",overlay:l,pane:"phantom"},t.options),properties:t.properties,geometry:{type:"Point",coordinates:n}}},s.prototype._updateOptions=function(e,t){this._objectManager.objects.setObjectOptions(e,t)},s.prototype.setLayoutTemplate=function(){var e=this;n(this._layoutTemplates).forEach(function(t){e._updateOptions(e._placemark[t].id,e._layoutTemplates[t])})},s.prototype.updateOptions=function(){var e=this;["dot","label"].forEach(function(t){a(e._placemark[t].options,e.getFormedOptionsForPlacemark(t)),e._updateOptions(e._placemark[t].id,e._placemark[t].options)})},s.prototype.setDataByZoom=function(e,t,o){var a=this;t.forEach(function(t){if("label"===t){var o=a._data.getStyles(e);a.setStyles({className:o.className,textSize:o.textSize,textColor:o.textColor})}a.setVisibilityForce("none"),a._data.setVisible(e,t,a._layout[t])});var n=this.setVisibility(o,this._data.getVisibility(e),this._data.getData("dotVisible")),l=this._data.getCenterCoords(e);return-1!==["label","dot"].indexOf(n)&&this._data.getSize(e,n)&&(this.setCoordinates(l),this.setOffsetAndIconShape(n,this._data.getSize(e,n),this._data.getOffset(e))),{currentVisibleType:n,currentConfiguredVisibileType:this._data.getVisibility(e),currentCenter:l}},s.prototype.setOffsetAndIconShape=function(e,t,o){var a=this.analyseOffset(t,o);this._updateOptions(this._placemark[e].id,{iconShape:this.analyseShape(e,t,o),iconLabelLeft:a.left,iconLabelTop:a.top})},s.prototype.setCoordinates=function(e){var t=this;e.toString()!==this._placemark.label.geometry.coordinates.toString()&&["dot","label"].forEach(function(o){t._objectManager.remove(t._placemark[o]),t._generateNewPlacemark(o),t._placemark[o].geometry.coordinates=e,t._objectManager.add(t._placemark[o])})},s.prototype.setStyles=function(e){var t=this.analyseStyles(e);t.isChange&&this._updateOptions(this._placemark.label.id,t.styles)},s.prototype.setVisibilityForce=function(e){var t=this;n(this._placemark).forEach(function(o){var a=t.analysePane(o,e),n=t._objectManager.objects.getById(t._placemark[o].id);n&&n.options.pane!==a&&t._updateOptions(t._placemark[o].id,{pane:a})})},s.prototype._generateNewPlacemark=function(e){this._placemark[e]=a({},this._placemark[e]);var t=this._placemark[e].id;this._placemark[e].id="_"===t[0]?t.slice(1):"_"+t},s}(s))}),ymaps.modules.define("polylabel.label.util.classHelper",[],function(e){function t(e,t){if(e){var o=e.getElement();if(o)return o.getElementsByClassName(t)[0]}}e({add:function(e,o,a){var n=t(e,o);n&&n.classList.add(a)},remove:function(e,o,a){var n=t(e,o);n&&n.classList.remove(a)}})}),ymaps.modules.define("polylabel.label.util.getLayoutSize",[],function(e){e(function(e){var t=e&&e.getElement();if(t&&(t=t.getElementsByClassName("ymaps-polylabel-view")[0])){var o=t.getBoundingClientRect();return{width:o.width,height:o.height}}})}),ymaps.modules.define("polylabel.label.util.LabelData",["util.objectKeys","polylabel.config","polylabel.util.zoom.parseZoomData","polylabel.util.getPolesOfInaccessibility","polylabel.util.zoom.setZoomVisibility","polylabel.util.transformPolygonCoords","polylabel.util.getPolygonWithMaxArea","polylabel.util.transformHexToRGB"],function(e,t,o,a,n,l,i,s,r){function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var c=o.MIN_ZOOM,u=o.MAX_ZOOM,y=o.DEFAULT_POLYGON_FILL_COLOR,b=a({"1_6":12,"7_18":14});e(function(){function e(t,o,a,n,l){p(this,e),this._map=n,this._label=l,this._polygon=t,this._data={zoomInfo:{},autoCenter:[0,0],dotVisible:"boolean"!=typeof o.labelDotVisible||o.labelDotVisible},this.parsedOptions=e._parseOptions(a),this._polygonCoordsWithMaxArea=i.polygon(s(this.getPolygonCoords())),this.updateDotDefaultFlag(),this._init()}return e.prototype.setData=function(e,t){this._data[e]=t},e.prototype.getData=function(e){return this._data[e]},e.prototype.setZoomInfo=function(e,t,o){this._data.zoomInfo[e][t]=o},e.prototype.getZoomInfo=function(e){return e||"number"==typeof e&&0===e?this._data.zoomInfo[e]:this._data.zoomInfo},e.prototype.getPolygonCoords=function(){return"collection"===this._label.getPolylabelType()?this._polygon.geometry.getCoordinates():this._polygon.geometry.coordinates},e.prototype.getLabelCursors=function(){var e={dot:{},label:{}};return"collection"===this._label.getPolylabelType()?(e.label.cursor=this._polygon.options.get("labelCursor")||"grab",e.dot.cursor=this._polygon.options.get("labelDotCursor")||"grab"):(e.label.cursor=this._polygon.options.labelCursor||"grab",e.dot.cursor=this._polygon.options.labelDotCursor||"grab"),e},e.prototype.getLabelDefaults=function(e){var t="collection"===this._label.getPolylabelType()?this._polygon.options.get("labelDefaults"):this._polygon.options.labelDefaults;if(t)return{className:"dark"===t?"ymaps-polylabel-label-default ymaps-polylabel-dark-label":"ymaps-polylabel-label-default ymaps-polylabel-light-label",textSize:b[e]}},e.prototype.getCenterCoords=function(e){return this.parsedOptions.labelCenterCoords&&this.parsedOptions.labelCenterCoords[e]||this._data.autoCenter},e.prototype.getStyles=function(e){var t=this.getLabelDefaults(e);return t?{className:t.className,textSize:t.textSize}:{className:this.parsedOptions.labelClassName&&this.parsedOptions.labelClassName[e],textSize:this.parsedOptions.labelTextSize&&this.parsedOptions.labelTextSize[e],textColor:this.parsedOptions.labelTextColor&&this.parsedOptions.labelTextColor[e]}},e.prototype.getPolygonFillColor=function(){return("collection"===this._label.getPolylabelType()?this._polygon.options.get("fillColor"):this._polygon.options.fillColor)||y},e.prototype.getDotColorByPolygonColor=function(){var e=this.getPolygonFillColor(),t=r(e,.9);return t&&(e=t),e},e.prototype.getVisibility=function(e){return this.parsedOptions.labelForceVisible&&this.parsedOptions.labelForceVisible[e]||this._data.zoomInfo[e].visible},e.prototype.getOffset=function(e){return this.parsedOptions.labelOffset&&this.parsedOptions.labelOffset[e]||[0,0]},e.prototype.updateDotDefaultFlag=function(){this.isDotDefault=!this._label.getPolygonOptions().labelDotLayout},e.prototype.getPermissibleInaccuracyOfVisibility=function(e){return this.parsedOptions.labelPermissibleInaccuracyOfVisibility&&this.parsedOptions.labelPermissibleInaccuracyOfVisibility[e]||0},e.prototype.getSize=function(e,t){return this._data.zoomInfo[e][t+"Size"]},e.prototype.setSize=function(e,t,o){o.height>0&&o.width>0&&(this._data.zoomInfo[e][t+"Size"]=o)},e.prototype.setVisible=function(e,t,o){if(!this.getSize(e,t)){var a=l(t,this._map,e,this._data.zoomInfo[e].visible,o,i.point(this.getCenterCoords(e),this._polygonCoordsWithMaxArea.isPositivePart),this._polygonCoordsWithMaxArea.coords,this.getOffset(e),this.getPermissibleInaccuracyOfVisibility(e));a&&(this._data.zoomInfo[e].visible=a.visible,this.setSize(e,t,a.size))}},e.prototype._checkParams=function(){if(!this._label.getPolygonOptions().labelLayout){var e="Не указан шаблон для подписи (labelLayout)";throw console.error(e),new Error(e)}},e.prototype._init=function(){this._checkParams();var t=n(this._polygonCoordsWithMaxArea.coords,1);this._data.autoCenter=t;for(var o=c;o<=u;o++)this._data.zoomInfo[o]=e._createDefaultZoomInfo(o)},e._parseOptions=function(e){var o={};return t(e).forEach(function(t){o[t]=a(e[t])}),o},e._createDefaultZoomInfo=function(){return{visible:"none",dotSize:void 0,labelSize:void 0}},e}())}),ymaps.modules.define("polylabel.label.util.LabelPlacemarkOverlay",["util.defineClass","overlay.Placemark","GeoObject"],function(e,t,o,a){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}e(function(e){function o(t,a,i){return n(this,o),l(this,e.call(this,t,a,i))}return t(o,e),o.prototype.getData=function(){var e=this._data.geoObject instanceof a?this._data.geoObject.properties.get("polygon"):this._data.properties.polygon;return{geoObject:e,properties:e.properties,state:e.state}},o}(o))}),ymaps.modules.define("polylabel.label.util.layoutTemplates.createLayoutTemplates",["templateLayoutFactory"],function(e,t){e(function(e,o){return{label:{iconLabelTemplateLayout:t.createClass(e)},dot:{iconLabelDotTemplateLayout:t.createClass(o||'<div {% style %}\n        background-color: {{geoObject.options.fillColor|dot-color}};{% endstyle %}\n        class="ymaps-polylabel-dot-default"></div>')}}})}),ymaps.modules.define("polylabel.label.util.layoutTemplates.dotLayoutTemplate",["templateLayoutFactory"],function(e,t){e(t.createClass('<div class="ymaps-polylabel-view" {% style %}position: {{options.labelPosition}};\n        top: {{options.labelTop}}px; left: {{options.labelLeft}}px; {% endstyle %}>\n            {% include options.labelDotTemplateLayout %}\n    </div>'))}),ymaps.modules.define("polylabel.label.util.layoutTemplates.getBaseLayoutTemplates",["polylabel.label.util.layoutTemplates.labelLayoutTemplate","polylabel.label.util.layoutTemplates.dotLayoutTemplate"],function(e,t,o){e(function(){return{label:t,dot:o}})}),ymaps.modules.define("polylabel.label.util.layoutTemplates.labelLayoutTemplate",["templateLayoutFactory"],function(e,t){e(t.createClass('\n    <div class="ymaps-polylabel-view" {% style %}position: {{options.labelPosition}};\n        top: {{options.labelTop}}px; left: {{options.labelLeft}}px; {% endstyle %}>\n        <div class="{{options.labelClassName}}"\n            {% style %}font-size: {{options.labelTextSize}}px;\n            color: {{options.labelTextColor}}; {% endstyle %}>\n                {% include options.labelTemplateLayout %}\n        </div>\n    </div>'))}),ymaps.modules.define("polylabel.polylabel.PolylabelBase",["template.filtersStorage","polylabel.config","polylabel.util.templateFilterStorage.dotColor"],function(e,t,o,a){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e(function(){function e(o){n(this,e),this._map=o,t.add("dot-color",a)}return e.prototype.getPolylabelType=function(){return this._polylabelType},e.prototype.initMapListeners=function(e){this._mapCallback=e,this._map.events.add(["boundschange","actionbegin","actionend"],this._mapEventsHandler,this)},e.prototype.destroyMapListeners=function(){this._map.events.remove(["boundschange","actionbegin","actionend"],this._mapEventsHandler,this)},e.prototype._mapEventsHandler=function(e){switch(e.get("type")){case"actionbegin":e.originalEvent.action.events.add("tick",this._actionTickHandler,this);break;case"actionend":e.originalEvent.action.events.remove("tick",this._actionTickHandler,this),this._zoomed&&(this._mapCallback("actionendzoomchange"),this._zoomed=!1)}},e.prototype._actionTickHandler=function(e){e.get("tick").zoom!==this._map.getZoom()&&(this._zoomed||this._mapCallback("actionbeginzoomchange"),this._zoomed=!0)},e.prototype.getOptions=function(e){return"collection"===this.getPolylabelType()?e.options.getAll():e.options},e.prototype.getConfigOptions=function(e){var t=this;return o.options.reduce(function(o,a){return o[a]="collection"===t.getPolylabelType()?e.options.get(a):e.options[a],o},{})},e.prototype.getConfigZoomRangeOptions=function(e){var t=this;return o.zoomRangeOptions.reduce(function(o,a){return o[a]="collection"===t.getPolylabelType()?e.options.get(a):e.options[a],o},{})},e.prototype.getConfigProperties=function(e){var t=this;return o.properties.reduce(function(o,a){return o[a]="collection"===t.getPolylabelType()?e.properties.get(a):e.properties[a],o},{})},e}())}),ymaps.modules.define("polylabel.polylabel.PolylabelCollection",["util.defineClass","util.WeakMap","vow","GeoObjectCollection","Monitor","system.nextTick","event.Manager","Event","polylabel.polylabel.PolylabelBase","polylabel.label.GeoObjectCollection.Label","polylabel.util.State"],function(e,t,o,a,n,l,i,s,r,p,c,u){function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}e(function(e){function p(t,a){y(this,p);var l=b(this,e.call(this,t));return l._map=t,l._labelsCollection=new n,l._labelsState=new u,l._userState=new u,l._polygonsCollection=a,l._isPolygonParentChange=new o,l._polylabelType="collection",l._init(),l}return t(p,e),p.prototype.destroy=function(){this._deleteLabelStateListeners(),this._deletePolygonsListeners(),this._deletePolygonCollectionListeners(),this._deleteLabelCollection(),this._map.geoObjects.remove(this._labelsCollection)},p.prototype.getLabelState=function(e){return this._userState.getState(e)},p.prototype._init=function(){var e=this;this._map.geoObjects.add(this._labelsCollection),this._firstCalculatePolygons().then(function(){e._initMapListeners(),e._initPolygonCollectionListeners(),e._initLabelCollectionListeners()})},p.prototype._firstCalculatePolygons=function(){var e=this;return this._clearLabelCollection(),this._polygonsCollection.each(function(t){e._calculateNewPolygon(t).then(function(o){e._setLabelData(t,o)})}),a.Promise.resolve()},p.prototype._calculatePolygons=function(){var e=this,t=[];return this._polygonsCollection.each(function(o){if("Polygon"===o.geometry.getType()){var a=e._labelsState.get(o,"label");a&&t.push(e._setLabelData(o,a))}}),a.Promise.all(t)},p.prototype._clearLabelCollection=function(){this._labelsCollection.removeAll(),this._labelsCollection.options.set({pane:"phantom"})},p.prototype._deleteLabelCollection=function(){var e=this;this._polygonsCollection.each(function(t){var o=e._labelsState.get(t,"label");o&&o.destroy()}),this._clearLabelCollection()},p.prototype._calculatePolygonLabelData=function(e,t){var o=this.getConfigOptions(e),n=this.getConfigZoomRangeOptions(e),l=t?this._labelsState.get(e,"label"):new c(this._map,e,this._labelsCollection,this);return l.createLabelData(o,n),l.createLayoutTemplates(),a.Promise.resolve(l)},p.prototype._setLabelData=function(e,t,o){var a=t.setDataByZoom(this._map.getZoom(),o);this._setCurrentConfiguredVisibility(e,a.currentConfiguredVisibileType),this._setCurrentVisibility(e,a.currentVisibleType),this._setCurrentCenter(e,a.currentCenter)},p.prototype._setCurrentCenter=function(e,t){this._userState.set(e,"center",t)},p.prototype._setCurrentConfiguredVisibility=function(e,t){this._userState.set(e,"currentConfiguredVisibility",t)},p.prototype._setCurrentVisibility=function(e,t){this._userState.set(e,"currentVisibility",-1!==["dot","label"].indexOf(t)?t:"none")},p.prototype._calculateNewPolygon=function(e){var t=this;return"Polygon"!==e.geometry.getType()?a.Promise.reject():new a.Promise(function(o){t._calculatePolygonLabelData(e).then(function(a){t._labelsState.set(e,"label",a),t._initUserStateListener(e),t._initPolygonListener(e),a.createPlacemarks(),a.addToCollection().then(function(){o(a)})})})},p.prototype._clearVisibilityInLabelsState=function(e){var t=this;this._polygonsCollection.each(function(o){t._userState.set(o,"visible",e)})},p.prototype._initUserStateListener=function(e){var t=this,o=new l(this._userState.getState(e));this._userState.set(e,"_labelMonitor",o),o.add("visible",function(o){t._setLabelData(e,t._labelsState.get(e,"label"),o)})},p.prototype._initPolygonListener=function(e){"Polygon"===e.geometry.getType()&&(e.events.add(["optionschange","propertieschange"],this._onPolygonOptionsChangeHandler,this),e.events.add("parentchange",this._onPolygonParentChangeHandler,this))},p.prototype._onPolygonParentChangeHandler=function(e){this._isPolygonParentChange.set(e.get("target"),!0)},p.prototype._onPolygonOptionsChangeHandler=function(e){var t=this;i(function(){var o=e.get("target"),a=t._labelsState.get(o,"label");!t._isPolygonParentChange.get(o)&&a&&(a.setVisibilityForce("none"),a.setLayoutTemplate(),t._calculatePolygonLabelData(o,!0).then(function(e){e.updateLayouts(),t._labelsState.set(o,"label",e),t._setLabelData(o,e)}))})},p.prototype._initPolygonCollectionListeners=function(){this._polygonsCollection.events.add(["add","remove"],this._polygonCollectionEventHandler,this)},p.prototype._polygonCollectionEventHandler=function(e){var t=this;switch(e.get("type")){case"add":var o=e.get("child");this._calculateNewPolygon(o).then(function(e){t._setLabelData(o,e)});break;case"remove":var a=e.get("child");this._deleteLabelStateListener(a);var n=this._labelsState.get(a,"label");n&&n.destroy()}},p.prototype._initLabelCollectionListeners=function(){var e=this,t=new s({controllers:[{onBeforeEventFiring:function(t,o,a){if("phantom"===a.get("target").options.get("pane"))return!1;var n=a.get("target").properties.get("polygon");if(!n)return!1;if("mouseenter"===o||"mouseleave"===o){var l=e._labelsState.get(n,"label");l&&l.getLabelData().isDotDefault&&("mouseenter"===o?l.addDotClass("ymaps-polylabel-dot-default_hover"):l.removeDotClass("ymaps-polylabel-dot-default_hover"))}var i=new r({target:n,type:"label"+o},a);return n.events.fire("label"+o,i),!1}}]});this._labelsCollection.events.setParent(t)},p.prototype._initMapListeners=function(){var e=this;this.initMapListeners(function(t){"actionendzoomchange"===t?(e._clearVisibilityInLabelsState(),e._calculatePolygons()):"actionbeginzoomchange"===t&&e._clearVisibilityInLabelsState("none")})},p.prototype._deleteLabelStateListeners=function(){var e=this;this._polygonsCollection.each(function(t){e._deleteLabelStateListener(t)})},p.prototype._deleteLabelStateListener=function(e){var t=this._userState.get(e,"_labelMonitor");t&&t.removeAll()},p.prototype._deletePolygonCollectionListeners=function(){this._polygonsCollection.events.remove(["add","remove"],this._polygonCollectionEventHandler,this),this.destroyMapListeners()},p.prototype._deletePolygonsListeners=function(){var e=this;this._polygonsCollection.each(function(t){e._deletePolygonListener(t)})},p.prototype._deletePolygonListener=function(e){e.events.remove(["optionschange","propertieschange"],this._onPolygonOptionsChangeHandler,this),e.events.remove("parentchange",this._onPolygonParentChangeHandler,this)},p}(p))}),ymaps.modules.define("polylabel.polylabel.PolylabelObjectManager",["util.defineClass","vow","Monitor","ObjectManager","system.nextTick","event.Manager","polylabel.polylabel.PolylabelBase","polylabel.label.ObjectManager.Label","polylabel.util.State"],function(e,t,o,a,n,l,i,s,r,p){function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}e(function(e){function s(t,o){c(this,s);var a=u(this,e.call(this,t));return a._map=t,a._polygonsObjectManager=o,a._labelsObjectManager=new n,a._labelsState=new p,a._userState=new p,a._polylabelType="objectmanager",a._init(),a}return t(s,e),s.prototype.destroy=function(){this._deleteLabelsOverlaysListeners(),this._deleteLabelStateListeners(),this._deletePolygonsListeners(),this._deletePolygonsObjectsListeners(),this._deleteLabelsOMListeners()},s.prototype.getLabelState=function(e){return this._userState.getState(e)},s.prototype._init=function(){var e=this;this._map.geoObjects.add(this._labelsObjectManager),this._initLabelsOverlaysListeners(),this._initPolygonsObjectsListeners(),this._initPolygonsListeners(),this._initLabelsOMListeners(),this._calculatePolygons().then(function(){return e._initMapListeners()})},s.prototype._calculatePolygons=function(){var e=this;return this._polygonsObjectManager.objects.each(function(t){e._calculateNewPolygon(t)}),o.Promise.resolve()},s.prototype._calculatePolygonLabelData=function(e,t){var a=this.getConfigOptions(e),n=this.getConfigZoomRangeOptions(e),l=t?this._labelsState.get(e,"label"):new r(this._map,e,this._labelsObjectManager,this);return l.createLabelData(a,n),l.createLayoutTemplates(),o.Promise.resolve(l)},s.prototype._setLabelData=function(e,t,o,a){var n=t.setDataByZoom(this._map.getZoom(),a,o);this._setCurrentConfiguredVisibility(e,n.currentConfiguredVisibileType),this._setCurrentVisibility(e,n.currentVisibleType),this._setCurrentCenter(e,n.currentCenter)},s.prototype._setCurrentCenter=function(e,t){this._userState.set(e,"center",t)},s.prototype._setCurrentConfiguredVisibility=function(e,t){this._userState.set(e,"currentConfiguredVisibility",t)},s.prototype._setCurrentVisibility=function(e,t){this._userState.set(e,"currentVisibility",-1!==["dot","label"].indexOf(t)?t:"none")},s.prototype._initLabelStateListener=function(e){var t=this,o=new a(this._userState.getState(e));this._userState.set(e,"_labelMonitor",o),o.add("visible",function(o){e&&t._setLabelData(e,t._labelsState.get(e,"label"),o,["dot","label"])})},s.prototype._initLabelsOverlaysListeners=function(){this._labelsObjectManager.objects.overlays.events.add(["add","remove"],this._labelsOverlaysEventHandler,this)},s.prototype._getLabelType=function(e){return-1!==e.indexOf("label#")?"label":"dot"},s.prototype._labelOverlaysGeometryChangeHandler=function(e){var t=this,o=e.get("target"),a=o._data.id;o.getLayout().then(function(e){var o=t._getLabelType(a),n=t._labelsObjectManager.objects.getById(a);if(n){var l=n.properties.polygon,i=t._labelsState.get(l,"label");i.setLayout(o,e),t._setLabelData(l,i,void 0,[o])}})},s.prototype._labelsOverlaysEventHandler=function(e){var t=this,o=e.get("objectId"),a=this._getLabelType(o),n=e.get("overlay");switch(e.get("type")){case"add":n.events.add("geometrychange",this._labelOverlaysGeometryChangeHandler,this),l(function(){n&&n.getLayout().then(function(e){if(e){var n=t._labelsObjectManager.objects.getById(o);if(n){var l=n.properties.polygon,i=t._labelsState.get(l,"label");i.setLayout(a,e),t._setLabelData(l,i,void 0,[a])}}})});break;case"remove":n.events.remove("geometrychange",this._labelOverlaysGeometryChangeHandler,this)}},s.prototype._clearVisibilityInLabelsState=function(e){var t=this;this._polygonsObjectManager.objects.each(function(o){t._userState.set(o,"visible",e)})},s.prototype._initMapListeners=function(){var e=this;this.initMapListeners(function(t){"actionendzoomchange"===t?e._clearVisibilityInLabelsState():"actionbeginzoomchange"===t&&e._clearVisibilityInLabelsState("none")})},s.prototype._initPolygonsObjectsListeners=function(){this._polygonsObjectManager.objects.events.add(["add","remove"],this._polygonCollectionEventHandler,this)},s.prototype._polygonCollectionEventHandler=function(e){switch(e.get("type")){case"add":var t=e.get("child");this._calculateNewPolygon(t);break;case"remove":var o=e.get("child");this._deleteLabelStateListener(o);var a=this._labelsState.get(o,"label");a&&a.destroy()}},s.prototype._calculateNewPolygon=function(e){var t=this;"Polygon"===e.geometry.type&&this._calculatePolygonLabelData(e).then(function(o){t._labelsState.set(e,"label",o),t._initLabelStateListener(e),o.createPlacemarks(),o.addToObjectManager()})},s.prototype._initPolygonsListeners=function(){this._polygonsObjectManager.objects.events.add(["optionschange","objectoptionschange"],this._onPolygonOptionsChangeHandler,this)},s.prototype._onPolygonOptionsChangeHandler=function(e){var t=this,o=this._polygonsObjectManager.objects.getById(e.get("objectId"));o&&this._calculatePolygonLabelData(o,!0).then(function(e){e.setVisibilityForce("none"),t._labelsState.set(o,"label",e),e.setLayoutTemplate(),e.updateOptions(),e.updateLayouts(),t._setLabelData(o,t._labelsState.get(o,"label"),void 0,["dot","label"])})},s.prototype._initLabelsOMListeners=function(){var e=this,t=new i({controllers:[{onBeforeEventFiring:function(t,o,a){var n=a.get("objectId");if(!n)return!1;var l=n.split("#")[1];l=isNaN(Number(l))?l:Number(l);var i=e._polygonsObjectManager.objects.getById(l),s=e._labelsObjectManager.objects.getById(n);if(s&&"phantom"===s.options.pane||!i)return!1;if("mouseenter"===o||"mouseleave"===o){var r=e._labelsState.get(i,"label");r&&r.getLabelData().isDotDefault&&("mouseenter"===o?r.addDotClass("ymaps-polylabel-dot-default_hover"):r.removeDotClass("ymaps-polylabel-dot-default_hover"))}return e._polygonsObjectManager.events.fire("label"+o,{objectId:l,type:"label"+o}),!1}}]});this._labelsObjectManager.events.setParent(t)},s.prototype._deleteLabelStateListeners=function(){var e=this;this._polygonsObjectManager.objects.each(function(t){"Polygon"===t.geometry.type&&e._deleteLabelStateListener(t)})},s.prototype._deleteLabelStateListener=function(e){var t=this._userState.get(e,"_labelMonitor");t&&t.removeAll()},s.prototype._deleteLabelsOverlaysListeners=function(){this._labelsObjectManager.objects.overlays.events.remove(["add","remove"],this._labelsOverlaysEventHandler,this)},s.prototype._deletePolygonsListeners=function(){this._polygonsObjectManager.objects.events.remove(["optionschange","objectoptionschange"],this._onPolygonOptionsChangeHandler,this)},s.prototype._deletePolygonsObjectsListeners=function(){this._polygonsObjectManager.objects.events.remove(["add","remove"],this._polygonCollectionEventHandler,this),this.destroyMapListeners()},s.prototype._deleteLabelsOMListeners=function(){var e=this;this._polygonsObjectManager.objects.each(function(t){var o=e._labelsState.get(t,"label");"Polygon"===t.geometry.type&&o&&o.destroy()}),this._clearLabels()},s.prototype._clearLabels=function(){this._labelsObjectManager.removeAll()},s}(s))}),ymaps.modules.define("util.createPolylabel",["src.polylabel.PolylabelCollection","src.polylabel.PolylabelObjectManager","ObjectManager"],function(e,t,o,a){function n(){var e=document.createElement("style");e.innerText="\n        .ymaps-polylabel-dot-default {\n            border: 1px solid rgba(255, 255, 255, 0.8);\n            height: 4px;\n            width: 4px;\n            border-radius: 3px;\n        }\n        .ymaps-polylabel-dot-default_hover {\n            border: 1px solid rgba(255, 255, 255, 1);\n        }\n        .ymaps-polylabel-label-default {\n            font-family: Arial, Helvetica, sans-serif;\n            text-align: center;\n        }\n        .ymaps-polylabel-dark-label {\n            color: #06264f;\n            text-shadow:\n            0 -1px 0 rgba( 255, 255, 255, 0.4 ),\n            0 -1px 0 rgba( 255, 255, 255, 0.4 ),\n            0 1px 0 rgba( 255, 255, 255, 0.4 ),\n            0 1px 0 rgba( 255, 255, 255, 0.4 ),\n            -1px 0 0 rgba( 255, 255, 255, 0.4 ),\n            1px 0 0 rgba( 255, 255, 255, 0.4 ),\n            -1px 0 0 rgba( 255, 255, 255, 0.4 ),\n            1px 0 0 rgba( 255, 255, 255, 0.4 ),\n            -1px -1px 0 rgba( 255, 255, 255, 0.4 ),\n            1px -1px 0 rgba( 255, 255, 255, 0.4 ),\n            -1px 1px 0 rgba( 255, 255, 255, 0.4 ),\n            1px 1px 0 rgba( 255, 255, 255, 0.4 ),\n            -1px -1px 0 rgba( 255, 255, 255, 0.4 ),\n            1px -1px 0 rgba( 255, 255, 255, 0.4 ),\n            -1px 1px 0 rgba( 255, 255, 255, 0.4 ),\n            1px 1px 0 rgba( 255, 255, 255, 0.4 );\n            opacity: 0.9;\n        }\n        .ymaps-polylabel-light-label {\n            color: rgba(255, 255, 255, 1);\n            text-shadow: 0 0 2px rgba(0, 0, 0, 1), 0 0 2px rgba(0, 0, 0, 1);\n        }\n    ",document.head.appendChild(e)}e(function(e,l){return n(),l instanceof a?new o(e,l):new t(e,l)})}),ymaps.modules.define("polylabel.util.checkPointPosition",[],function(e){function t(e,t,l){var i=o(l,t),s=o(e,t),r=i[0]*s[1]-s[0]*i[1];return r>0?"LEFT":r<0?"RIGHT":i[0]*s[0]<0||i[1]*s[1]<0?"BEHIND":a(i)<a(s)?"BEYOND":n(t,e)?"ORIGIN":n(l,e)?"DESTINATION":"BETWEEN"}function o(e,t){return[e[0]-t[0],e[1]-t[1]]}function a(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))}function n(e,t){return e[0]===t[0]&&e[1]===t[1]}function l(e,o){var a=o[0],n=o[1];switch(t(e,a,n)){case"LEFT":return a[1]<e[1]&&e[1]<=n[1]?"CROSSING":"INESSENTIAL";case"RIGHT":return n[1]<e[1]&&e[1]<=a[1]?"CROSSING":"INESSENTIAL";case"BETWEEN":case"ORIGIN":case"DESTINATION":return"TOUCHING";default:return"INESSENTIAL"}}e(function(e,t){for(var o=0,a=0;a<t.length-1;a++)switch(l(e,[t[a],t[a+1]])){case"TOUCHING":return"BOUNDARY";case"CROSSING":o=1-o}return o?"INSIDE":"OUTSIDE"})}),ymaps.modules.define("polylabel.util.getPolesOfInaccessibility",[],function(e){function t(e,a){if(!(this instanceof t))return new t(e,a);if(this.data=e||[],this.length=this.data.length,this.compare=a||o,this.length>0)for(var n=this.length>>1;n>=0;n--)this._down(n)}function o(e,t){return e<t?-1:e>t?1:0}function a(e,t,o){t=t||1;for(var a,i,r,c,u=0;u<e[0].length;u++){var y=e[0][u];(!u||y[0]<a)&&(a=y[0]),(!u||y[1]<i)&&(i=y[1]),(!u||y[0]>r)&&(r=y[0]),(!u||y[1]>c)&&(c=y[1])}var b=r-a,h=c-i,f=Math.min(b,h),g=f/2,d=new p(null,n);if(0===f)return[a,i];for(var _=a;_<r;_+=f)for(var m=i;m<c;m+=f)d.push(new l(_+g,m+g,g,e));var v=s(e),L=new l(a+b/2,i+h/2,0,e);L.d>v.d&&(v=L);for(var C=d.length;d.length;){var O=d.pop();O.d>v.d&&(v=O,o&&console.error("found best %d after %d probes",Math.round(1e4*O.d)/1e4,C)),O.max-v.d<=t||(g=O.h/2,d.push(new l(O.x-g,O.y-g,g,e)),d.push(new l(O.x+g,O.y-g,g,e)),d.push(new l(O.x-g,O.y+g,g,e)),d.push(new l(O.x+g,O.y+g,g,e)),C+=4)}return o&&(console.error("num probes: "+C),console.error("best distance: "+v.d)),[v.x,v.y]}function n(e,t){return t.max-e.max}function l(e,t,o,a){this.x=e,this.y=t,this.h=o,this.d=i(e,t,a),this.max=this.d+this.h*Math.SQRT2}function i(e,t,o){for(var a=!1,n=1/0,l=0;l<o.length;l++)for(var i=o[l],s=0,p=i.length,c=p-1;s<p;c=s++){var u=i[s],y=i[c];u[1]>t!=y[1]>t&&e<(y[0]-u[0])*(t-u[1])/(y[1]-u[1])+u[0]&&(a=!a),n=Math.min(n,r(e,t,u,y))}return(a?1:-1)*Math.sqrt(n)}function s(e){for(var t=0,o=0,a=0,n=e[0],i=0,s=n.length,r=s-1;i<s;r=i++){var p=n[i],c=n[r],u=p[0]*c[1]-c[0]*p[1];o+=(p[0]+c[0])*u,a+=(p[1]+c[1])*u,t+=3*u}return 0===t?new l(n[0][0],n[0][1],0,e):new l(o/t,a/t,0,e)}function r(e,t,o,a){var n=o[0],l=o[1],i=a[0]-n,s=a[1]-l;if(0!==i||0!==s){var r=((e-n)*i+(t-l)*s)/(i*i+s*s);r>1?(n=a[0],l=a[1]):r>0&&(n+=i*r,l+=s*r)}return i=e-n,s=t-l,i*i+s*s}e(function(e,t,o){return a([e],t,o)}),t.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return--this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,o=this.compare,a=t[e];e>0;){var n=e-1>>1,l=t[n];if(o(a,l)>=0)break;t[e]=l,e=n}t[e]=a},_down:function(e){for(var t=this.data,o=this.compare,a=this.length>>1,n=t[e];e<a;){var l=1+(e<<1),i=l+1,s=t[l];if(i<this.length&&o(t[i],s)<0&&(l=i,s=t[i]),o(s,n)>=0)break;t[e]=s,e=l}t[e]=n}};var p=t}),ymaps.modules.define("polylabel.util.getPolygonWithMaxArea",["util.calculateArea","GeoObject"],function(e,t,o){e(function(e){if(void 0===t)throw new Error("Didn't find calculateArea module");for(var a=Number.MIN_VALUE,n=0,l=0;l<e.length;l++){var i=new o({geometry:{type:"Polygon",coordinates:[e[l]]}}),s=Math.round(t(i));a<s&&(a=s,n=l)}return e[n]})}),ymaps.modules.define("polylabel.util.State",["util.WeakMap","data.Manager"],function(e,t,o){function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e(function(){function e(){a(this,e),this._state=new t}return e.prototype._getDataManager=function(e){var t=this._state.get(e);return t||(t=new o,this._state.set(e,t)),t},e.prototype.set=function(e,t,o){this._getDataManager(e).set(t,o)},e.prototype.get=function(e,t){var o=this._getDataManager(e);if(o)return o.get(t)},e.prototype.getState=function(e){return this._getDataManager(e)},e}())}),ymaps.modules.define("polylabel.util.templateFilterStorage.dotColor",["polylabel.util.transformHexToRGB","polylabel.config"],function(e,t,o){e(function(e,a){return t(a||o.DEFAULT_POLYGON_FILL_COLOR,.9)})}),ymaps.modules.define("polylabel.util.transformHexToRGB",[],function(e){e(function(e,t){if(e){if(-1!==e.indexOf("rgb"))return e;e=(e="#"!==e[0]?"#"+e:e).slice(0,7);var o=void 0;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(e))return 3===(o=e.substring(1).split("")).length&&(o=[o[0],o[0],o[1],o[1],o[2],o[2]]),o="0x"+o.join(""),"rgba("+[o>>16&255,o>>8&255,255&o].join(",")+", "+(t||1)+")"}})}),ymaps.modules.define("polylabel.util.transformPolygonCoords",[],function(e){function t(e,t,o){return e?a(t,o):n(t,o)}function o(e){return[{key:"180",distance:180-e[1]},{key:"-180",distance:Math.abs(-180-e[1])},{key:"0",distance:Math.abs(e[1])}].sort(l)[0].key}function a(e,t){return"-180"===e?[t[0],360+t[1]]:t}function n(e,t){return"180"===e?[t[0],-360+t[1]]:t}function l(e,t){return e.distance-t.distance}e({polygon:function(e){for(var a=[],n=!0,l=0;l<e.length;l++){var i=e[l];0===l&&(n=i[1]>=0);var s=o(i);a.push(t(n,s,i))}return{coords:a,isPositivePart:n}},point:function(e,a){return t(a,o(e),e)}})}),ymaps.modules.define("polylabel.util.zoom.getFirstZoomInside",["polylabel.util.checkPointPosition","polylabel.config"],function(e,t,o){function a(e,t,o,a,n,l){var i=e.options.get("projection").toGlobalPixels(t,o),s=a.width,r=a.height;i[0]+=n[0],i[1]+=n[1];var p=[],c=[];return p.push([i[0]-s/2,i[1]-r/2],[i[0]-s/2,i[1]+r/2],[i[0]+s/2,i[1]-r/2],[i[0]+s/2,i[1]+r/2]),c.push([p[0][0]+l>i[0]?i[0]:p[0][0]+l,p[0][1]+l>i[1]?i[1]:p[0][1]+l],[p[1][0]+l>i[0]?i[0]:p[1][0]+l,p[1][1]-l<i[1]?i[1]:p[1][1]-l],[p[2][0]-l<i[0]?i[0]:p[2][0]-l,p[2][1]+l>i[1]?i[1]:p[2][1]+l],[p[3][0]-l<i[0]?i[0]:p[3][0]-l,p[3][1]-l<i[1]?i[1]:p[3][1]-l]),{normal:p,withInaccuracy:c}}function n(e,o,a,n){for(var l=0;l<a.length;l++){var i=e.options.get("projection").fromGlobalPixels(a[l],n);if("INSIDE"!==t(i,o))return!1}return!0}e(function(e,t,l,i,s,r){for(var p=o.MIN_ZOOM,c=o.MAX_ZOOM,u=void 0;p<c;){u=Math.floor((p+c)/2);var y=isNaN(Number(r))?0:Number(r),b=a(e,t,u,i,s||[0,0],y);n(e,l,b.normal,u)||0!==y&&n(e,l,b.withInaccuracy,u)?c=u:p=u+1}return p})}),ymaps.modules.define("polylabel.util.zoom.parseZoomData",["util.array","util.objectKeys","polylabel.config"],function(e,t,o,a){function n(e,t,o){e[t]=o}function l(e,t,o){if(isNaN(Number(t))){var a=t.split("_").map(Number);if(!isNaN(a[0])&&!isNaN(a[1]))for(var n=a[0]<r?r:a[0],l=a[1]>p?p:a[1];n<=l;)e[n]=o,n++}else e[Number(t)]=o}function i(e){for(var t={},o=r;o<=p;o++)t[o]=e;return t}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=a.MIN_ZOOM,p=a.MAX_ZOOM;e(function(e){var a=["number","string","boolean","object"];return e&&!t.isArray(e)&&"object"===(void 0===e?"undefined":s(e))?o(e).reduce(function(t,o){return"string"==typeof o?l(t,o,e[o]):"number"==typeof o&&n(t,o,e[o]),t},i()):a.includes(void 0===e?"undefined":s(e))?i(e):void 0})}),ymaps.modules.define("polylabel.util.zoom.setZoomVisibility",["polylabel.util.zoom.getFirstZoomInside","polylabel.label.util.getLayoutSize"],function(e,t,o){function a(e,t,o){var a=["none","dot","label"],n=e;return o&&(n=a.indexOf(t)>a.indexOf(e)?t:e),n}function n(e,n,l,i,s,r,p,c,u){var y=o(s);if(y&&0!==y.width&&0!==y.height)return{visible:a(i,e,l>=t(n,r,p,y,c,u)),size:y}}e(function(e,t,o,a,l,i,s,r,p){return n(e,t,o,a,l,i,s,r,p)})});